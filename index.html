<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#4f86ff" name="theme-color"/>
<link rel="manifest" href="./manifest.webmanifest"/>
<link rel="apple-touch-icon" href="./icons/icon-180.png"/>
<link rel="icon" href="./icons/icon-192.png"/>
<meta content="telephone=no" name="format-detection"/>
<title>Basket Jump — PWA</title>
<meta content="Programmes de détente verticale (6, 10, 12 semaines) : PWA iPhone, calendrier, suivi et cases à cocher." name="description"/>
<style>
    /* ===== Reset & base ===== */
    *,*::before,*::after{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%;height:100%}
    :root{
      color-scheme:light dark;
      --bg:#0d1117; --fg:#f5f7fb; --muted:#9aa3b2;
      --card:#0d1118; --border:#1a2232;
      --accent:#4f86ff; --accent2:#22d3ee;
      --brand-sky:#bfe9ff; --brand-ball:#ff8a00; --brand-seam:#cc6b00;
      --ok:#22c55e; --warn:#f59e0b;
      --radius:22px; --shadow:0 16px 60px rgba(0,0,0,.18);
      --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
    }
    @media (prefers-color-scheme:light){
      :root{
        --bg:#0d1117; --fg:#0b1220; --muted:#667085;
        --card:#ffffff; --border:#e6ebf4;
        --shadow:0 18px 40px rgba(0,0,0,.08);
      }
    }
    body{
      margin:0; height:100%;
      background:
        #0d1117 18%, transparent), transparent 60%),
        #0d1117 14%, transparent), transparent 60%),
        #0d1117 96%, transparent), var(--bg) 70%);
      color:var(--fg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
      letter-spacing:.2px;
    }
    .container{ width:100%; max-width:430px; margin-inline:auto; }
    .aurora{ position:fixed; inset:-10% -10% auto -10%; height:60vh; pointer-events:none; z-index:0; filter: blur(60px); opacity:.5 }
    .blob{ position:absolute; border-radius:999px; }
    .b1{ width:420px; height:420px; left:8%; top:10%; background: color-mix(in lab, var(--accent) 40%, transparent); animation: float 14s ease-in-out infinite alternate }
    .b2{ width:520px; height:520px; right:10%; top:0%; background: color-mix(in lab, var(--accent2) 32%, transparent); animation: float 16s ease-in-out 1s infinite alternate-reverse }
    .b3{ width:380px; height:380px; left:30%; top:-6%; background: color-mix(in lab, #a78bfa 26%, transparent); animation: float 18s ease-in-out .3s infinite alternate }
    @keyframes float{ from{ transform: translateY(0)} to{ transform: translateY(-12px)} }
    @media (prefers-reduced-motion: reduce){ .aurora{ display:none } }

    .splash{ position:fixed; inset:0; display:grid; place-items:center; z-index:50;
      background: #0d1117 22%, transparent), transparent 60%), var(--bg);
      transition: opacity .5s ease, visibility .5s ease;
    }
    .splash.hide{ opacity:0; visibility:hidden }
    .brand{ display:grid; place-items:center; gap:16px; text-align:center }
    .logoTile{ width:96px; height:96px; border-radius:26px; box-shadow:var(--shadow); position:relative }
    .pulse{ position:absolute; inset:-10px; border-radius:32px; filter:blur(24px); opacity:.25; background: #0d1117, transparent); animation: pulse 1.2s ease-out infinite alternate }
    @keyframes pulse{ from{ transform: scale(1)} to{ transform: scale(1.05)} }
    .bar{ width:min(460px,70vw); height:6px; border-radius:999px; overflow:hidden; border:1px solid var(--border); background:#0003 }
    .bar i{ display:block; height:100%; width:0%; background: #0d1117, var(--accent2)); animation: loadbar 1.1s ease forwards }
    @keyframes loadbar{ to{ width:100% } }
    .brand h1{ margin:0; font-size:20px; letter-spacing:.3px }

    header{
      position:sticky; top:0; z-index:5;
      padding: calc(12px + var(--safe-top)) 16px 12px;
      backdrop-filter:saturate(1.12) blur(10px);
      background: color-mix(in lab, var(--bg) 78%, transparent);
      border-bottom:1px solid var(--border);
    }
    .title{ display:flex; align-items:center; gap:12px }
    .logoTileSm{ width:38px; height:38px; border-radius:14px; box-shadow:var(--shadow) }
    h1{ font-size:18px; margin:0 }
    .muted{ color:var(--muted) }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }

    main{ position:relative; z-index:1; padding:16px; padding-bottom: calc(18px + var(--safe-bottom)); }
    .card{ background: #0d1117 96%, transparent), color-mix(in lab, var(--card) 84%, transparent)); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px; }
    .grid{ display:grid; gap:12px }

    .btn{ appearance:none; border:1px solid var(--border); background:color-mix(in lab, var(--accent) 12%, var(--card)); color:var(--fg); padding:12px 16px; border-radius:14px; font-weight:800; cursor:pointer; transition: transform .06s ease; touch-action: manipulation }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background:#0d1117, var(--accent2)); color:white; border-color: color-mix(in lab, var(--accent) 50%, black) }
    .btn.ghost{ background:transparent }
    .pill{ padding:6px 10px; border-radius:999px; background:color-mix(in lab, var(--accent) 16%, transparent); color:var(--accent); font-weight:800; font-size:12px }
    select, input[type="date"]{
      appearance:none; border:1px solid var(--border); border-radius:14px; padding:10px 12px;
      font:inherit; background:var(--card); color:var(--fg);
    }

    .focus .controls{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px }
    .ctrl{ width:44px; height:44px; border-radius:14px; display:grid; place-items:center; border:1px solid var(--border); background:#0d1117 96%, transparent), color-mix(in lab, var(--card) 86%, transparent)); font-weight:900 }
    .ctrl:active{ transform: scale(.98) }
    .stack{ position:relative; min-height:190px; }
    .pane{
      position:absolute; inset:0; border-radius:22px; border:1px solid var(--border); padding:14px; text-align:center;
      background: #0d1117 96%, transparent), color-mix(in lab, var(--card) 84%, transparent));
      box-shadow: var(--shadow);
      transform: translateX(0); opacity:1;
      transition: transform .28s cubic-bezier(.2,.7,.3,1), opacity .28s;
      display:grid; place-items:center;
    }
    .pane .big{ font-size:64px; font-weight:900; line-height:1; }
    .pane .sub{ margin-top:4px; font-size:12px; color:var(--muted) }
    .pane .title{ margin-top:8px; font-size:14px; color:var(--accent); font-weight:800 }
    .enter-from-right{ transform: translateX(100%); opacity:.6 }
    .enter-from-left{ transform: translateX(-100%); opacity:.6 }
    .exit-to-left{ transform: translateX(-100%); opacity:.2 }
    .exit-to-right{ transform: translateX(100%); opacity:.2 }

    .cal{ display:grid; grid-template-columns: repeat(7,1fr); gap:12px }
    .dow{ text-align:center; font-size:12px; color:var(--muted); position:sticky; top:0; z-index:1; background:#0d1117 96%, transparent), transparent); padding:6px 0 4px; }
    .calWrap{ max-height:50vh; overflow:auto; overscroll-behavior:contain; scroll-behavior:smooth; border-radius:18px; -webkit-overflow-scrolling: touch; }
    .fadeMask{ mask-image: #0d1117, transparent 100%); -webkit-mask-image: #0d1117, transparent 100%); }

    .day{
      position:relative; aspect-ratio:1/1; border:1px solid transparent; border-radius:22px;
      background:
        #0d1117 96%, transparent), color-mix(in lab, var(--card) 80%, transparent)) padding-box,
        #0d1117 50%, transparent), color-mix(in lab, var(--accent2) 40%, transparent)) border-box;
      padding:8px; display:flex; flex-direction:column; justify-content:center; align-items:center;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
      overflow:hidden;
    }
    .day:hover{ transform: translateY(-2px); box-shadow:0 18px 46px rgba(0,0,0,.2) }
    .day:active{ transform: scale(.98) }
    .day .n{ font-weight:900; font-size:20px }
    .day .label{ margin-top:2px; font-size:10px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100% }
    .day .done{ position:absolute; right:8px; top:8px; width:9px; height:9px; border-radius:999px; background:var(--ok); box-shadow:0 0 0 4px color-mix(in lab, var(--ok) 20%, transparent) }
    .day.today{ box-shadow: 0 10px 32px color-mix(in lab, var(--accent) 24%, transparent) }

    .legend{ display:flex; gap:8px; align-items:center; justify-content:flex-end; font-size:12px; }
    .dot{ width:10px; height:10px; border-radius:999px; background:var(--ok); box-shadow:0 0 0 4px color-mix(in lab, var(--ok) 20%, transparent) }

    .modal{ position:fixed; inset:0; display:none; place-items:center; z-index:40; }
    .modal.open{ display:grid; }
    .overlay{ position:absolute; inset:0; background:color-mix(in lab, black 45%, transparent); backdrop-filter: blur(6px); animation: fade .2s both }
    .sheet{ position:relative; width:min(720px, 94vw); max-height:90vh; overflow:auto; border-radius:24px; border:1px solid var(--border);
      background:
        #0d1117 96%, transparent), color-mix(in lab, var(--card) 84%, transparent)) padding-box,
        #0d1117 50%, transparent), color-mix(in lab, var(--accent2) 44%, transparent)) border-box;
      box-shadow: var(--shadow); animation: sheetIn .24s cubic-bezier(.2,.7,.3,1) both
    }
    .sheet header{ position:sticky; top:0; background:#0d1117 78%, transparent), transparent); border-bottom:1px solid var(--border); padding:14px 16px }
    .sheet .content{ padding:14px 16px 18px }
    .titleRow{ display:flex; justify-content:space-between; align-items:center; gap:10px }
    .x{ appearance:none; background:transparent; border:1px solid var(--border); width:38px; height:38px; border-radius:12px; display:grid; place-items:center; color:var(--muted); font-weight:900; }
    .list{ display:grid; gap:10px; padding:0; margin:0; list-style:none }
    .item{ display:flex; align-items:flex-start; gap:10px; border:1px dashed var(--border); border-radius:16px; padding:10px; background: color-mix(in lab, var(--card) 92%, transparent) }
    .check{ width:22px; height:22px; accent-color: var(--accent) }
    .disabled{ opacity:.5; pointer-events:none }
    @keyframes fade{ from{ opacity:0 } to{ opacity:1 } }
    @keyframes sheetIn{ from{ transform: translateY(10px); opacity:0 } to{ transform:none; opacity:1 } }
  </style>
<style id="no-loader-patch">
/* Loader removal patch */
#loader, #loading, #splash, #splash-screen, #preloader, #pre-load, #page-loader, #overlay-loader,
.loader, .loading, .loading-overlay, .splash, .splash-screen, .preloader, .pre-load, .page-loader, .overlay-loader, .spinner, .screen-loader {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}
body.loading, body.is-loading { overflow: auto !important; }
.hidden, .invisible, .d-none, .is-hidden { display: initial !important; visibility: visible !important; opacity: 1 !important; }
</style><script id="no-loader-script">
document.addEventListener('DOMContentLoaded', function() {
  ['loader','loading','splash','splash-screen','preloader','pre-load','page-loader','overlay-loader'].forEach(function(id){
    var el = document.getElementById(id);
    if (el && el.parentNode) { el.parentNode.removeChild(el); }
  });
  document.body.classList.remove('loading','is-loading');
  var app = document.getElementById('app') || document.getElementById('root') || document.querySelector('main,.app,[data-app]');
  if (app) {
    app.style.removeProperty('display');
    app.style.removeProperty('visibility');
    app.style.removeProperty('opacity');
    app.classList.remove('hidden','invisible','d-none','is-hidden');
  }
});
</script><style id="solid-bg-patch">
/* Solid background override */
html, body {
  background: #0d1117 !important;
  background-color: #0d1117 !important;
}
</style></head>
<body>
<div aria-hidden="true" class="aurora">
<div class="blob b1"></div>
<div class="blob b2"></div>
<div class="blob b3"></div>
</div>
<div class="container">
<header>
<div class="title">
<svg class="logoTileSm" viewbox="0 0 100 100">
<rect fill="var(--brand-sky)" height="100" rx="18" width="100" x="0" y="0"></rect>
<circle cx="50" cy="50" fill="var(--brand-ball)" r="24"></circle>
<path d="M28,50 C40,52 60,48 72,50" fill="none" opacity=".85" stroke="var(--brand-seam)" stroke-width="4"></path>
<path d="M50,26 C48,40 52,60 50,74" fill="none" opacity=".85" stroke="var(--brand-seam)" stroke-width="4"></path>
</svg>
<div>
<h1>Basket Jump</h1>
<div class="muted">Programmes 6, 10, 12 semaines · iPhone‑15 optimisé</div>
</div>
</div>
<div class="row" style="margin-top:10px; gap:10px">
<div class="pill">Programme</div>
<select aria-label="Sélecteur de programme" id="programSelect">
<option value="pro6">FR · PRO Performance — 6 semaines</option>
<option value="hg10">EN · The Hoops Geek — 10 weeks</option>
<option value="vc12">FR · Vert Code (inspiré) — 12 semaines</option>

<option value="full">FR · Programme Complet (Basket + Physique)</option>
</select>
<div class="pill">Début</div>
<input id="cycleStart" type="date"/>
<button class="btn primary" id="btnToday">Aujourd'hui</button>
</div>
</header>
<main class="grid">
<section aria-label="Sélecteur de jour (focus)" class="card focus">
<div class="controls">
<button aria-label="Jour précédent" class="ctrl" id="prevBtn">◀</button>
<div class="muted" id="focusMeta"></div>
<button aria-label="Jour suivant" class="ctrl" id="nextBtn">▶</button>
</div>
<div class="stack" id="focusStack">
<div class="pane" id="paneA">
<div>
<div class="big" id="numA">—</div>
<div class="sub" id="subA">—</div>
<div class="title" id="titleA">—</div>
<div style="margin-top:10px"><button class="btn" id="btnA">Voir la séance</button></div>
</div>
</div>
<div class="pane" id="paneB" style="display:none">
<div>
<div class="big" id="numB">—</div>
<div class="sub" id="subB">—</div>
<div class="title" id="titleB">—</div>
<div style="margin-top:10px"><button class="btn" id="btnB">Voir la séance</button></div>
</div>
</div>
</div>
</section>
<div class="card">
<div class="row" style="justify-content:space-between; align-items:center">
<div class="row" style="align-items:baseline; gap:10px">
<div id="monthLabel" style="font-weight:900; font-size:18px">Mois</div>
<div class="muted" id="cycleHint"></div>
</div>
<div class="legend"><span class="dot"></span> fait</div>
</div>
<div aria-label="Calendrier du mois" class="calWrap fadeMask" id="calendarScroll" role="region">
<div class="cal">
<div class="dow">Lun</div><div class="dow">Mar</div><div class="dow">Mer</div><div class="dow">Jeu</div><div class="dow">Ven</div><div class="dow">Sam</div><div class="dow">Dim</div>
</div>
<div class="cal" id="calendarGrid"></div>
</div>
</div>
</main>
</div>
<div class="modal" id="modal">
<div class="overlay" id="overlay"></div>
<div class="sheet">
<header>
<div class="titleRow">
<div>
<div id="modalDate" style="font-size:12px; color:var(--muted)"></div>
<div id="modalTitle" style="font-size:16px; font-weight:900; color:var(--accent)">Séance</div>
<div id="modalPhase" style="font-size:12px; color:var(--muted)"></div>
</div>
<button class="x" id="close">✕</button>
</div>
</header>
<div class="content">
<ul class="list" id="workList"></ul>
<div class="row" style="margin-top:12px">
<button class="btn" id="checkAll">Tout cocher</button>
<button class="btn primary" id="saveClose">Terminer</button>
</div>
<div class="muted" id="infoNote" style="margin-top:8px"></div>
</div>
</div>
</div>
<script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js').catch(console.error));
    }

    // ===== Helpers dates =====
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    const pad = n => String(n).padStart(2,'0');
    const ISO = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const fromISO = iso => { const [Y,M,D]=iso.split('-').map(Number); return new Date(Y,M-1,D); };
    const addDays = (iso, n) => { const d = fromISO(iso); d.setDate(d.getDate()+n); return ISO(d); };
    const diffDays = (a,b)=> Math.floor((fromISO(b)-fromISO(a))/86400000);
    const mod = (n,m)=> ((n % m) + m) % m;
    const fmtMonth = (y,m)=> new Date(y,m,1).toLocaleDateString('fr-CH',{month:'long',year:'numeric'});
    const DOWS = ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']; // 0..6
    const DOWS_MF = ['Lun','Mar','Mer','Jeu','Ven','Sam','Dim']; // Monday-first label

    // ===== Programs (generated structures) =====
    function makeDay(title, items){ return { title, items }; }

    // PRO Performance 6 weeks (5 entraînements/semaine)
    function buildPRO6(){
      const weeks = [];
      for(let w=1; w<=6; w++){
        const intens = w<=2 ? 'Base' : (w<=4 ? 'Progression' : 'Intensif');
        weeks.push([
          makeDay(`S${w}Lun — Plyo + Chevilles (${intens})`, [
            "Échauffement : corde 5′ + mobilité hanches/chevilles",
            "Ankle hops 4×20 · pogos 3×15",
            "Sauts verticaux max 5×5 (repos 60–90s)",
            "Fentes sautées 3×10/jambe",
            "Mollets debout 3×20",
            "Gainage planche 3×40s"
          ]),
          makeDay(`S${w}Mar — Force légère (KB 10kg)`, [
            "Échauffement dynamique 6′",
            "Goblet squat 4×10 (tempo explosif)",
            "Fentes avant 3×10/jambe (KB)",
            "Soulevé JT (KB) 3×12",
            "Hip thrust 3×12 (tempo rapide)",
            "Core : side plank 3×30s/côté"
          ]),
          makeDay(`S${w}Mer — Réactivité + Agilité`, [
            "Corde à sauter 5′ (double-unders si possible)",
            "Slalom jumps 4×20 (latéraux courts)",
            "Depth drops 4×5 (30–40cm) + stick landings",
            "Pas rapides échelle 4×20s",
            "Sprint 4×20m (repos complet)",
            "Étirements dynamiques 5′"
          ]),
          makeDay(`S${w}Jeu — Force dynamique (KB)`, [
            "Échauffement 6′",
            "KB swing 5×12",
            "Bulgarian split squat 3×8/jambe (KB)",
            "Jump squats 4×6 (poids du corps)",
            "Nordic curl assisté 3×6 (si possible)",
            "Gainage hollow 3×25s"
          ]),
          makeDay(`S${w}Ven — Combo Power`, [
            "Circuit ×4 : KB swing 12 · goblet 10 · fentes sautées 8/j · burpees 10",
            "Sprints 3×30m",
            "Sauts touches cercle 3×8 (temps de contact au sol minimal)",
            "Mobility 6′"
          ]),
          makeDay(`S${w}Sam — Session Dunk/Tech`, [
            "Échauffement 10′ (lay‑ups 2 mains, mobilité)",
            "Approche 2 pieds : 6×3 tentatives (vidéo si possible)",
            "Dunks 1 main → 2 mains : 6×3 tentatives",
            "Finitions main faible 3×10",
            "LF 3×10 (≥80%)"
          ]),
          makeDay(`S${w}Dim — Repos actif`, [
            "Marche légère 20–30′",
            "Mobilité complète (hanches, chevilles)",
            "Respiration / bain froid (optionnel)"
          ])
        ]);
      }
      return weeks;
    }

    // The Hoops Geek 10 weeks (3 séances/sem)
    function buildHG10(){
      const weeks = [];
      for(let w=1; w<=10; w++){
        const phase = w<=3 ? 'Phase 1 — Base' : (w<=7 ? 'Phase 2 — Puissance' : 'Phase 3 — Réactivité');
        const mon = w<=3 ?
          makeDay(`S${w}Lun — ${phase}`, [
            "Warm‑up : corde 5–8′ + dynamique",
            "Ankle hops 3×25 · lateral line jumps 3×20",
            "Bodyweight squats 3×15 (explosif)",
            "Split squats 3×10/jambe",
            "Plank 3×40s · back extensions 3×12"
          ]) :
          (w<=7 ? makeDay(`S${w}Lun — ${phase}`, [
            "Warm‑up 6′",
            "Power skipping 4×30m",
            "Tuck jumps 4×6",
            "Depth jumps 4×5 (30–40cm)",
            "Pistol squat assisté 3×6/jambe"
          ]) : makeDay(`S${w}Lun — ${phase}`, [
            "Warm‑up 6′",
            "Rim jumps 5×6 (contact au sol minimal)",
            "Seated box jumps 5×5",
            "Sprints 4×30m (repos complet)",
            "Mobility 5′"
          ]));
        const wed = w<=3 ? makeDay(`S${w}Mer — ${phase}`, [
            "Warm‑up 6′",
            "Drop & freeze 4×5 (30–40cm)",
            "Box jumps 4×6 (60–90s repos)",
            "Single‑leg RDL (poids du corps/KB) 3×10/j",
            "Side plank 3×30s/côté"
          ]) :
          (w<=7 ? makeDay(`S${w}Mer — ${phase}`, [
            "Warm‑up 6′",
            "Med‑ball back throws 4×6 (ou KB swing léger)",
            "Boundings 3×20m",
            "Depth jumps 4×5 (40–50cm)",
            "Core : hollow 3×25s"
          ]) : makeDay(`S${w}Mer — ${phase}`, [
            "Warm‑up 6′",
            "Depth jumps 5×4 (hauteur modérée)",
            "Rim touches 5×6 (enchaînés)",
            "Sprints 4×20m",
            "Mobility 5′"
          ]));
        const fri = w<=3 ? makeDay(`S${w}Ven — ${phase}`, [
            "Warm‑up 6′",
            "Jump squats 4×8 (poids du corps)",
            "Lunge jumps 3×8/j",
            "Calf raises 3×20",
            "Plank variations 3×40s"
          ]) :
          (w<=7 ? makeDay(`S${w}Ven — ${phase}`, [
            "Warm‑up 6′",
            "Seated box jumps 4×5",
            "Single‑leg bounds 3×20m",
            "KB goblet squat 4×8 (explosif)",
            "Side plank 3×35s/côté"
          ]) : makeDay(`S${w}Ven — ${phase}`, [
            "Warm‑up 6′",
            "Rim jumps 5×6",
            "Tuck jumps 4×6",
            "Plyo push‑ups 3×8 (transfer upper)",
            "Mobility 5′"
          ]));
        weeks.push([
          mon,
          makeDay(`S${w}Mar — Mobility`, [
            "Corde 5′ + mobilité complète 10′",
            "Foam roll 5′"
          ]),
          wed,
          makeDay(`S${w}Jeu — Off / léger`, [
            "Marche 20′ · étirements doux"
          ]),
          fri,
          makeDay(`S${w}Sam — Session dunk`, [
            "Approche 2 pieds : 6×3 tentatives",
            "Dunk 1→2 mains : 5×3",
            "LF : 3×10"
          ]),
          makeDay(`S${w}Dim — Repos`, [
            "Repos complet ou mobilité douce"
          ])
        ]);
      }
      return weeks;
    }

    // Vert Code Inspired 12 weeks (Force -> Puissance -> Réactivité)
    function buildVC12(){
      const weeks = [];
      for(let w=1; w<=12; w++){
        const phase = w<=4 ? 'Phase 1 — Force' : (w<=8 ? 'Phase 2 — Puissance' : 'Phase 3 — Réactivité');
        weeks.push([
          makeDay(`S${w}Lun — ${phase}`, [
            "Échauffement 8′ + mobilité hanches/chevilles",
            ...(w<=4 ? [
              "Goblet squat (KB) 5×8",
              "Hip thrust 4×10",
              "Nordic curl assisté 3×6",
              "Plank 3×45s"
            ] : w<=8 ? [
              "KB swing 5×12",
              "Trap/KB jump shrug 4×5 (léger)",
              "Depth drops 4×5 (40cm)",
              "Hollow hold 3×25s"
            ] : [
              "Rim jumps réactifs 6×6",
              "Depth jumps 5×4 (hauteur modérée)",
              "Sprints 5×20m",
              "Mobility 6′"
            ])
          ]),
          makeDay(`S${w}Mar — Technique de saut`, [
            "Approche 2 pieds : 6×3 tentatives",
            "Séquence : drop step ➜ 2 pieds ➜ finition 2 mains",
            "Vidéo/feedback (si possible)",
            "Mobility 8′"
          ]),
          makeDay(`S${w}Mer — ${phase}`, [
            ...(w<=4 ? [
              "Bulgarian split squat 4×8/j (KB)",
              "Soulevé JT (KB) 4×10",
              "Jump squats 4×6",
              "Core : side plank 3×35s/côté"
            ] : w<=8 ? [
              "Bounds 4×20m",
              "Tuck jumps 4×6",
              "KB goblet squat 4×6 (explosif)",
              "Back extensions 3×12"
            ] : [
              "Rim touches enchaînés 6×6",
              "Seated box jumps 5×5",
              "Sprints 4×30m (repos complet)",
              "Mobility 6′"
            ])
          ]),
          makeDay(`S${w}Jeu — Upper/Tronc (support)`, [
            "Pompes 4×12 · tractions/rows 4×10",
            "Plyo push‑ups 3×8",
            "Twist (KB) 3×20 · hollow 3×25s",
            "Étirements épaules/chevilles 6′"
          ]),
          makeDay(`S${w}Ven — ${phase}`, [
            ...(w<=4 ? [
              "Goblet squat 4×8 (lourd possible)",
              "Hip hinge (KB) 4×10",
              "Mollets 4×18",
              "Plank 3×45s"
            ] : w<=8 ? [
              "Med‑ball/KB throws 4×6",
              "Depth jumps 5×4 (50cm si ok)",
              "Lunge jumps 4×8/j",
              "Core : anti‑rotation 3×10/side"
            ] : [
              "Rim jumps (temps de contact minimal) 6×6",
              "Sprints 5×20m",
              "Mobility 8′"
            ])
          ]),
          makeDay(`S${w}Sam — Session Dunk/Match`, [
            "Échauffement 10′ + lay‑ups",
            "Dunk 2 pieds 2 mains : 8×3",
            "Scénarios match : rebond ➜ dunk, réception ➜ dunk",
            "LF : 3×10 (≥80%)"
          ]),
          makeDay(`S${w}Dim — Repos`, [
            "Repos complet ou marche + mobilité"
          ])
        ]);
      }
      return weeks;
    }

// Programme Complet (hebdo) — se répète chaque semaine
function buildFull(){
  const weeks = [];
  weeks.push([
    makeDay("S1Lun — Dribbles avancés & finition", [
      "Échauffement : course légère 5 min, montées de genoux/talons-fesses/pas chassés 3 min, dribbles statiques 2 min",
      "Combos Cross-Dribble (15 min) : crossover bas → entre jambes → derrière le dos",
      "Dribble entre jambes → behind-the-back spin move",
      "Crossover → in-and-out → changement de direction explosif",
      "Finition Euro Step : 10 répétitions de chaque côté",
      "Floater : 10 répétitions de chaque côté",
      "Lay-up main inversée : 10 répétitions de chaque côté",
      "Retour au calme : étirements bas du corps"
    ]),
    makeDay("S1Mar — Entraînement Club", [
      "Concentration totale : applique les points travaillés en solo",
      "Finitions en conditions de match (floaters, euro step, main faible)"
    ]),
    makeDay("S1Mer — Renforcement physique", [
      "Échauffement identique au lundi",
      "Jambes & explosivité : squats avec poids 4×8–10 + box jumps (ou squats sautés 4×15)",
      "Haut du corps : développé couché 4×8 (ou pompes 4×15) + tractions 4 séries (max) (ou dips 4×15)",
      "Gainage : planche 4×1 min",
      "Retour au calme : étirements complets"
    ]),
    makeDay("S1Jeu — Vitesse & tir en situation", [
      "Échauffement identique au lundi",
      "Tirs après dribble (20 min) : step-back (20 tirs, mains alternées), pull-up après sprint (20 tirs)",
      "Tirs créatifs (20 min) : spin move → tir · feinte de corps → tir en suspension",
      "Retour au calme : étirements bas du corps"
    ]),
    makeDay("S1Ven — Entraînement Club", [
      "Application : teste tes nouvelles compétences en match",
      "Cible les floaters et euro steps quand l’occasion se présente"
    ]),
    makeDay("S1Sam — Match ou séance intensive", [
      "Match : applique les combinaisons techniques apprises",
      "Si pas de match (90 min) :",
      "· 30 min conditionnement : suicides ×5 · sprints 15 m ×10",
      "· 30 min technique : 10 combos cross‑dribble, 10 tirs step‑back (par côté)",
      "· 30 min finition & tir : 20 lay‑ups · 20 lancers‑francs · 20 tirs mi‑distance"
    ]),
    makeDay("S1Dim — Repos & analyse", [
      "Repos complet du corps",
      "Analyse vidéo : observe mouvements/combos de tes joueurs préférés"
    ])
  ]);
  return weeks;
}


    const PROGRAMS = {
pro6: { name:"PRO Performance — 6 semaines", totalWeeks:6, weeks: buildPRO6() },
      hg10: { name:"The Hoops Geek — 10 weeks", totalWeeks:10, weeks: buildHG10() },
      vc12: { name:"Vert Code (inspiré) — 12 semaines", totalWeeks:12, weeks: buildVC12() },
    
  full: { name:"Programme Complet (Basket + Physique)", totalWeeks:1, weeks: buildFull() }
};

    // ===== State =====
    let today = new Date();
    let todayISO = ISO(today);
    let viewYear = today.getFullYear();
    let viewMonth = today.getMonth();
    let cycleStart = localStorage.getItem('cycleStart') || todayISO;
    let programKey = localStorage.getItem('programKey') || 'pro6';
    let focusDate = todayISO;

    const programSelect = $('#programSelect');
    programSelect.value = programKey;
    $('#cycleStart').value = cycleStart;

    // ===== Plan lookup =====
    function getWeekIndex(iso){
      const days = Math.max(0, diffDays(cycleStart, iso));
      return Math.floor(days/7); // 0-based week
    }
    function getProgram(){ return PROGRAMS[programKey] || PROGRAMS.pro6; }
    function planFor(iso){
      const prog = getProgram();
      let w = getWeekIndex(iso); // 0..
      if (w >= prog.totalWeeks) w = prog.totalWeeks - 1; // après la fin, on répète la dernière semaine
      const week = prog.weeks[w];
      const wd = fromISO(iso).getDay(); // 0=Dim..6=Sam
      // map to Monday-first index 0..6
      const idx = (wd+6)%7;
      return { data: week[idx], weekNum: w+1, phase: inferPhase(prog, w+1) };
    }
    function inferPhase(prog, weekNum){
      if (prog === PROGRAMS.pro6){
        if (weekNum<=2) return "Base";
        if (weekNum<=4) return "Progression";
        return "Intensif";
      }
      if (prog === PROGRAMS.hg10){
        if (weekNum<=3) return "Phase 1 — Base";
        if (weekNum<=7) return "Phase 2 — Puissance";
        return "Phase 3 — Réactivité";
      }
      if (prog === PROGRAMS.vc12){
        if (weekNum<=4) return "Phase 1 — Force";
        if (weekNum<=8) return "Phase 2 — Puissance";
        return "Phase 3 — Réactivité";
      }
      return "";
    }

    // ===== Focus rendering & animation =====
    function dayIndex(iso){
      const days = Math.max(0, diffDays(cycleStart, iso));
      return (days % 7);
    }
    function updatePane(paneId, iso){
      const d = fromISO(iso);
      const num = d.getDate();
      const meta = planFor(iso);
      const sub = `${DOWS[d.getDay()]} · Semaine ${meta.weekNum}/${getProgram().totalWeeks}`;
      const title = meta.data?.title || "Séance";
      const idBase = (paneId==='A') ? 'A' : 'B';
      document.getElementById('num'+idBase).textContent = String(num);
      document.getElementById('sub'+idBase).textContent = sub;
      document.getElementById('title'+idBase).textContent = title;
      const btn = document.getElementById('btn'+idBase);
      btn.onclick = ()=>{
        const isToday = iso === todayISO;
        openModal(iso, isToday);
      };
      document.getElementById('focusMeta').textContent = (iso===todayISO) ? "Aujourd'hui" : `Sélection : ${iso}`;
    }

    let showingA = true;
    function animateTo(targetISO, direction){
      if(targetISO === focusDate) return;
      const currentPane = showingA ? $('#paneA') : $('#paneB');
      const nextPane = showingA ? $('#paneB') : $('#paneA');
      nextPane.style.display = 'grid';
      nextPane.classList.remove('enter-from-left','enter-from-right','exit-to-left','exit-to-right');
      currentPane.classList.remove('enter-from-left','enter-from-right','exit-to-left','exit-to-right');

      updatePane(showingA ? 'B' : 'A', targetISO);
      if(direction === 'next'){ nextPane.classList.add('enter-from-right'); } else { nextPane.classList.add('enter-from-left'); }
      void nextPane.offsetWidth;
      if(direction === 'next'){ currentPane.classList.add('exit-to-left'); } else { currentPane.classList.add('exit-to-right'); }
      nextPane.classList.remove('enter-from-right','enter-from-left');

      const onEnd = ()=>{
        currentPane.style.display = 'none';
        currentPane.classList.remove('exit-to-left','exit-to-right');
        showingA = !showingA;
        focusDate = targetISO;
        currentPane.removeEventListener('transitionend', onEnd);
      };
      currentPane.addEventListener('transitionend', onEnd);
    }

    function renderFocus(){
      updatePane('A', focusDate);
      $('#paneA').style.display = 'grid';
      $('#paneB').style.display = 'none';
      showingA = true;
    }

    // ===== Calendar render =====
    function renderCalendar(){
      $('#monthLabel').textContent = fmtMonth(viewYear, viewMonth);
      const prog = getProgram();
      $('#cycleHint').textContent = `${prog.name} · Début ${cycleStart}`;
      const grid = $('#calendarGrid'); grid.innerHTML = '';
      const first = new Date(viewYear, viewMonth, 1);
      const startOffset = (first.getDay() + 6) % 7; // Monday=0
      const daysInMonth = new Date(viewYear, viewMonth+1, 0).getDate();
      for(let i=0;i<startOffset;i++){ const ph = document.createElement('div'); grid.appendChild(ph); }
      let todayEl = null;
      for(let d=1; d<=daysInMonth; d++){
        const date = new Date(viewYear, viewMonth, d);
        const iso = ISO(date);
        const cell = document.createElement('button');
        cell.className = 'day'; cell.type = 'button';
        const dow = DOWS_MF[(date.getDay()+6)%7];
        const meta = planFor(iso);
        cell.innerHTML = `<div class="n">${d}</div><div class="label">${dow} · S${meta.weekNum}/${getProgram().totalWeeks}</div>`;
        if(todayISO === iso){ cell.classList.add('today'); todayEl = cell; }
        const doneKey = `done:${programKey}:${cycleStart}:${iso}`;
        try{
          const saved = JSON.parse(localStorage.getItem(doneKey) || '[]');
          const planLen = (meta.data?.items || []).length;
          if(saved.length && saved.filter(Boolean).length >= planLen && planLen>0){
            const dot = document.createElement('i'); dot.className='done'; cell.appendChild(dot);
          }
        }catch(e){}
        cell.addEventListener('click', ()=> {
          const direction = (iso > focusDate) ? 'next' : 'prev';
          animateTo(iso, direction);
          openModal(iso, iso===todayISO);
        });
        grid.appendChild(cell);
      }
      const sc = $('#calendarScroll');
      if(sc && todayEl){
        const top = todayEl.offsetTop + todayEl.offsetHeight/2 - sc.clientHeight/2;
        sc.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });
      } else if(sc) { sc.scrollTop = 0; }
    }

    // ===== Modal =====
    function openModal(iso, isToday){
      const meta = planFor(iso);
      $('#modal').classList.add('open');
      $('#modalDate').textContent = `Date : ${iso} · Semaine ${meta.weekNum}/${getProgram().totalWeeks}`;
      $('#modalTitle').textContent = meta.data?.title || "Séance";
      $('#modalPhase').textContent = meta.phase || "";
      const UL = $('#workList'); UL.innerHTML='';
      const key = `done:${programKey}:${cycleStart}:${iso}`;
      let saved = [];
      try{ saved = JSON.parse(localStorage.getItem(key) || '[]'); }catch(e){}
      (meta.data?.items || []).forEach((txt, i)=>{
        const li = document.createElement('li'); li.className='item';
        const cb = document.createElement('input'); cb.type='checkbox'; cb.className='check'; cb.checked = !!saved[i];
        if(!isToday) cb.disabled = true;
        cb.addEventListener('change', ()=>{ saved[i] = cb.checked; });
        const p = document.createElement('div'); p.textContent = txt;
        li.append(cb, p); UL.appendChild(li);
      });
      $('#checkAll').onclick = ()=>{
        const cbs = $$('#workList .check');
        const allChecked = cbs.every(c=>c.checked || c.disabled);
        cbs.forEach(c=>{ if(!c.disabled) c.checked = !allChecked; });
        saved = (meta.data?.items || []).map((_,i)=> $$('#workList .check')[i].checked );
      };
      $('#saveClose').onclick = ()=>{
        localStorage.setItem(key, JSON.stringify(saved));
        closeModal(); renderCalendar();
      };
      $('#infoNote').textContent = isToday ? 
        "Coche les exercices à mesure. Données sauvegardées pour ce programme et ce début de cycle." :
        "Lecture seule (tu ne peux cocher que le jour actuel).";
      $('#overlay').onclick = closeModal;
      $('#close').onclick = closeModal;
      function closeModal(){ $('#modal').classList.remove('open'); }
    }

    // ===== Controls =====
    $('#cycleStart').addEventListener('change', ()=>{
      if(!$('#cycleStart').value) return;
      cycleStart = $('#cycleStart').value;
      localStorage.setItem('cycleStart', cycleStart);
      renderCalendar(); renderFocus();
    });
    $('#btnToday').addEventListener('click', ()=>{
      const direction = (todayISO > focusDate) ? 'next' : 'prev';
      animateTo(todayISO, direction);
    });
    $('#prevBtn').addEventListener('click', ()=> animateTo(addDays(focusDate,-1),'prev'));
    $('#nextBtn').addEventListener('click', ()=> animateTo(addDays(focusDate, 1),'next'));
    $('#programSelect').addEventListener('change', ()=>{
      programKey = programSelect.value;
      localStorage.setItem('programKey', programKey);
      renderCalendar(); renderFocus();
    });

    // ===== Init =====
    function hideSplash(){ const s = document.getElementById('splash'); if(s) s.classList.add('hide'); }
    window.addEventListener('load', ()=>{
      renderCalendar();
      renderFocus();
      setTimeout(hideSplash, 950);
    });
  
    // ===== Exercise Dictionary (FR/EN + how-to) =====
    const EX_DICT = {
      "corde à sauter": { cat:"Échauffement", fr:"Corde à sauter", en:"Jump rope",
        how:"Saute à deux pieds ou en alternant, rythme régulier (5–10').",
        cues:["Regarde devant","Épaules détendues","Petits rebonds rapides"] },
      "échauffement dynamique": { cat:"Échauffement", fr:"Échauffement dynamique", en:"Dynamic warm-up",
        how:"Enchaîne montées de genoux, talons-fesses, fentes marchées, cercles de bras (6–8').",
        cues:["Mouvement contrôlé","Amplitude progressive"] },
      "mobilité hanches/chevilles": { cat:"Mobilité", fr:"Mobilité hanches/chevilles", en:"Hip/ankle mobility",
        how:"Rotations de cheville, ouverture de hanche, squat profond tenu.",
        cues:["Respire calmement","Ne force pas la douleur"] },

      "ankle hops": { cat:"Pliométrie", fr:"Sauts de chevilles", en:"Ankle hops",
        how:"Petits sauts sur place, jambes tendues, rebond par les chevilles/mollets.",
        cues:["Contact sol très court","Tends les chevilles","Reste gainé"] },
      "pogos": { cat:"Pliométrie", fr:"Pogos", en:"Pogos",
        how:"Variante plus puissante des ankle hops, cherche plus d’élévation.",
        cues:["Explose vers le haut","Garde la cadence rapide"] },
      "sauts verticaux max": { cat:"Pliométrie", fr:"Sauts verticaux max", en:"Max vertical jumps",
        how:"Saute au maximum vers un repère (cercle/planche), repos complet entre répétitions.",
        cues:["Bras fouettés","Extension triple (cheville-genou-hanche)","Atterris souple"] },
      "fentes sautées": { cat:"Pliométrie", fr:"Fentes sautées", en:"Jump lunges",
        how:"Depuis une fente, saute et alterne les jambes en l’air.",
        cues:["Tronc droit","Genou avant au-dessus du pied","Réception douce"] },
      "depth drop": { cat:"Pliométrie", fr:"Saut en contrebas (réception)", en:"Depth drop",
        how:"Descends d’une box (30–50cm) et absorbe l’atterrissage, sans resaut.",
        cues:["Pied à plat","Genoux souples","Tronc gainé"] },
      "depth jump": { cat:"Pliométrie", fr:"Saut en contrebas (re-saut)", en:"Depth jump",
        how:"Descends d’une box puis ressaute immédiatement le plus haut possible.",
        cues:["Contact au sol minimal","Regarde le repère","Explose vers le haut"] },
      "box jumps": { cat:"Pliométrie", fr:"Sauts sur box", en:"Box jumps",
        how:"Saute sur un support stable, réceptionne en squat partiel.",
        cues:["Genoux alignés","Pieds à plat sur la box","Descends prudemment"] },
      "slalom jumps": { cat:"Pliométrie", fr:"Sauts latéraux rapides", en:"Lateral line jumps",
        how:"Sauts gauche/droite par-dessus une ligne, à haute fréquence.",
        cues:["Pieds rapides","Amplitude courte","Reste gainé"] },
      "boundings": { cat:"Pliométrie", fr:"Foulées bondissantes", en:"Bounds",
        how:"Foulées longues et explosives, comme un triple sauteur.",
        cues:["Projette la hanche","Bras actifs","Garde l’équilibre"] },
      "tuck jumps": { cat:"Pliométrie", fr:"Sauts groupés", en:"Tuck jumps",
        how:"Saute haut et ramène les genoux vers la poitrine.",
        cues:["Montée de genoux rapide","Évite l’affaissement à la réception"] },
      "rim jumps": { cat:"Pliométrie", fr:"Sauts au cercle", en:"Rim jumps",
        how:"Sauts répétés pour toucher le cercle, contact sol minimal.",
        cues:["Temps de contact très court","Vise un point fixe"] },
      "rim touches": { cat:"Pliométrie", fr:"Touches de cercle", en:"Rim touches",
        how:"Même principe, focalisé sur la répétition propre.",
        cues:["Cadence régulière","Atterris souple"] },
      "seated box jumps": { cat:"Pliométrie", fr:"Sauts assis vers box", en:"Seated box jumps",
        how:"Pars assis, lève-toi et saute immédiatement sur une box.",
        cues:["Pas d’élan","Explose depuis l’arrêt","Réception stable"] },
      "leap frog jumps": { cat:"Pliométrie", fr:"Sauts grenouille", en:"Leap frog jumps",
        how:"Depuis bas, saute loin en avant en puissance.",
        cues:["Regarde loin","Balance les bras","Atterris talon-plein pied"] },
      "power skipping": { cat:"Pliométrie", fr:"Skippings puissants", en:"Power skipping",
        how:"Skippings explosifs sur 20–30m, accent sur l’élévation.",
        cues:["Genou haut","Pied actif","Rythme puissant"] },
      "drop & freeze": { cat:"Pliométrie", fr:"Drop & Freeze (réception)", en:"Drop and freeze",
        how:"Descends d’une box et fige la réception (stabilité).",
        cues:["Genoux alignés avec pieds","Tronc stable","Pas de valgus"] },

      "goblet squat": { cat:"Force (KB)", fr:"Squat gobelet", en:"Goblet squat",
        how:"Tiens la KB contre la poitrine, descends en squat complet et remonte explosif.",
        cues:["Pieds largeur épaules","Genoux suivent orteils","Dos neutre"] },
      "soulevé jt": { cat:"Force (KB)", fr:"Soulevé de terre jambes tendues", en:"Stiff-leg deadlift",
        how:"Descends la KB le long des cuisses, hanches en arrière, ischios étirés, remonte.",
        cues:["Dos droit","Poids sur talons","Ne verrouille pas les genoux"] },
      "fentes avant": { cat:"Force (KB)", fr:"Fentes avant", en:"Forward lunges",
        how:"Grand pas devant, descends en contrôlant, pousse pour revenir.",
        cues:["Tronc gainé","Genou au-dessus du pied","Talons au sol"] },
      "hip thrust": { cat:"Force", fr:"Élévations de hanches", en:"Hip thrust",
        how:"Dos sur banc, pieds au sol, monte les hanches fort en serrant les fessiers.",
        cues:["Tête neutre","Genoux ~90° en haut","Amplitude complète"] },
      "bulgarian split squat": { cat:"Force (KB)", fr:"Fente bulgare", en:"Bulgarian split squat",
        how:"Pied arrière sur banc, descends en squat unilatéral, remonte.",
        cues:["Hanche basse","Genou avant stable","Pousse le sol"] },
      "kb swing": { cat:"Force (KB)", fr:"Swing kettlebell", en:"Kettlebell swing",
        how:"Hinge de hanches, projette la KB à hauteur poitrine en explosant des hanches.",
        cues:["Dos neutre","Épaules relâchées","La KB flotte"] },
      "jump shrug": { cat:"Puissance (KB)", fr:"Haussement explosif", en:"Jump shrug",
        how:"Flexion légère, extension violente jambe/hanche + haussement d’épaules.",
        cues:["Pieds ancrés","Extension complète","Mouvement fluide"] },
      "med-ball throws": { cat:"Puissance", fr:"Lancers med-ball", en:"Med-ball throws",
        how:"Lance en arrière par-dessus la tête ou contre un mur, hanche explosive.",
        cues:["Gainage serré","Utilise les hanches","Attrape en sécurité"] },
      "kb throws": { cat:"Puissance (KB)", fr:"Lancers avec KB (léger)", en:"KB throws (light)",
        how:"Variante avec charge légère et prudence si pas de med-ball.",
        cues:["Priorité sécurité","Charge légère","Trajectoire dégagée"] },

      "plank": { cat:"Core", fr:"Planche", en:"Plank",
        how:"Appui avant-bras, corps aligné, serre fessiers et abdos.",
        cues:["Respire","Ne cambre pas","Cou neutre"] },
      "side plank": { cat:"Core", fr:"Planche latérale", en:"Side plank",
        how:"Appui sur un coude côté, corps droit, hanches hautes.",
        cues:["Épaules empilées","Hanche haute","Respire"] },
      "hollow hold": { cat:"Core", fr:"Position creuse", en:"Hollow hold",
        how:"Allongé, bras/jambes tendus légèrement décollés, bas du dos collé.",
        cues:["Bas du dos au sol","Bras collés oreilles","Petite amplitude"] },
      "anti-rotation": { cat:"Core", fr:"Anti-rotation", en:"Anti-rotation",
        how:"Résiste à une traction latérale (élastique) sans tourner le buste.",
        cues:["Hanches carrées","Côtes rentrées","Respire"] },
      "twist": { cat:"Core", fr:"Rotation avec charge", en:"Russian twist",
        how:"Assis, torse penché, pivote de gauche à droite avec charge.",
        cues:["Mouvement contrôlé","Pas de vitesse excessive","Dos neutre"] },

      "calf raises": { cat:"Mollets", fr:"Extensions mollets", en:"Calf raises",
        how:"Monte sur la pointe des pieds puis redescends lentement.",
        cues:["Pleine amplitude","Pause en haut","Contrôle en bas"] },
      "back extensions": { cat:"Chaîne post.", fr:"Extensions du dos", en:"Back extensions",
        how:"Allongé ventre au sol ou sur banc romain, tends le dos puis reviens.",
        cues:["Ne casse pas la nuque","Monte sans jeter","Contracte fessiers"] },
      "plyo push-ups": { cat:"Haut du corps", fr:"Pompes pliométriques", en:"Plyometric push-ups",
        how:"Pompes avec impulsion pour décoller les mains.",
        cues:["Coude ~45°","Tronc gainé","Amortis en douceur"] },
      "pistol squat assisté": { cat:"Force unilat.", fr:"Pistol assisté", en:"Assisted pistol squat",
        how:"Squat sur une jambe avec appui léger (barre/porte) pour l’équilibre.",
        cues:["Talons au sol","Genou suit orteils","Descends contrôlé"] },
      "single-leg rdl": { cat:"Force unilat.", fr:"SDT roumain 1 jambe", en:"Single-leg RDL",
        how:"Charnière de hanche sur une jambe, buste penché, jambe arrière tendue.",
        cues:["Hanches carrées","Dos neutre","Touche le sol si mobilité"] },

      "sprints": { cat:"Vitesse", fr:"Sprints", en:"Sprints",
        how:"Accélérations 20–30m, retour en marchant (repos complet).",
        cues:["Buste légèrement penché","Genoux hauts","Bras actifs"] },
      "mobilité": { cat:"Mobilité", fr:"Mobilité", en:"Mobility",
        how:"Étirements dynamiques et statiques ciblés hanches/chevilles/ischios.",
        cues:["Sans douleur","Respiration calme","Répétitions régulières"] }
    };

    
// --- Patch: add missing exercise details ---
try {
  Object.assign(EX_DICT, {
    "bulgarian split squat": {
      cat: "Force unilatérale (Lower)",
      fr: "Bulgarian split squat",
      en: "Bulgarian split squat",
      how: "Place le pied arrière sur un banc/step, l’avant assez loin pour que le tibia reste quasi vertical en bas. Descends en gardant le buste légèrement penché, bassin neutre, genou avant suivant l’axe des orteils. Remonte en poussant fort dans le talon/milieu du pied avant. Charge en goblet avec la kettlebell si indiqué.",
      cues: [
        "Grand pas, pied avant stable (voûte active)",
        "Genou avant suit les orteils — pas vers l’intérieur",
        "Buste légèrement penché, hanche avant recule",
        "Descente contrôlée (2–3 s) → montée explosive",
        "Talons au sol, fessiers gainés en haut (sans sur‑étendre le dos)"
      ]
    }
  });
} catch(e) { console.warn('Patch EX_DICT failed', e); }
// --- End patch ---

// --- Patch: add detailed descriptions for common conditioning & basketball skills ---
try {
  // Extend normalization map by wrapping existing normalizeName with extra aliases
  const _normalizeNamePrev = normalizeName;
  normalizeName = function(txt){
    let t = _normalizeNamePrev(txt);
    const m = {
      "combos cross-dribble": "cross-dribble combo",
      "cross dribble": "cross-dribble combo",
      "cross-dribble": "cross-dribble combo",
      "step back": "step-back",
      "pull up": "pull-up",
      "spin move": "spin move",
      "euro step": "euro step",
      "floater": "floater",
      "lay-up main inversée": "reverse layup",
      "lay up main inversée": "reverse layup",
      "lay up inversé": "reverse layup",
      "lancers francs": "lancers-francs",
      "lf": "lancers-francs",
      "tirs mi distance": "tirs à mi-distance",
      "tirs à mi distance": "tirs à mi-distance",
      "dribbles statiques": "dribbles statiques",
      "course légère": "course légère",
      "montées de genoux": "montées de genoux",
      "talons fesses": "talons-fesses",
      "pas chassés": "pas chassés",
      "étirements bas du corps": "étirements bas du corps",
      "étirements complets": "étirements complets",
      "suicides": "suicides",
      "sprints m": "sprints",
      "entraînement club": "entraînement club",
      "analyse vidéo": "analyse vidéo",
      "conditionnement": "conditionnement"
    };
    return m[t] || t;
  };

  Object.assign(EX_DICT, {
    // Échauffements & mobilité
    "course légère": {
      cat: "Échauffement",
      fr: "Course légère",
      en: "Easy jog",
      how: "Cours à faible intensité pour élever la température corporelle et activer la mobilité (5–10 min).",
      cues: ["Respiration nasale si possible", "Épaules détendues", "Cadence confortable"]
    },
    "montées de genoux": {
      cat: "Échauffement",
      fr: "Montées de genoux",
      en: "High knees",
      how: "Sur place ou en déplacement, monte les genoux à hauteur de hanche en rythme rapide.",
      cues: ["Buste droit", "Pieds actifs", "Bras dynamiques"]
    },
    "talons-fesses": {
      cat: "Échauffement",
      fr: "Talons‑fesses",
      en: "Butt kicks",
      how: "Amène le talon vers les fesses en alternant, cadence légère à modérée.",
      cues: ["Genou pointant vers le sol", "Appuis rapides", "Relâche les épaules"]
    },
    "pas chassés": {
      cat: "Échauffement",
      fr: "Pas chassés latéraux",
      en: "Defensive slides",
      how: "Déplacements latéraux sans croiser les pieds, bassin bas.",
      cues: ["Hanches basses", "Pieds parallèles", "Regarde devant"]
    },
    "dribbles statiques": {
      cat: "Technique balle",
      fr: "Dribbles statiques (haut/bas/œil levé)",
      en: "Stationary dribbles",
      how: "Alterne dribbles hauts et bas à une main, puis change de main en gardant la tête levée.",
      cues: ["Main au‑dessus/au côté du ballon", "Rythme contrôlé", "Posture athlétique"]
    },

    // Skills panier
    "cross-dribble combo": {
      cat: "Handles",
      fr: "Combo Cross‑Dribble",
      en: "Cross‑dribble combo",
      how: "Enchaîne crossover bas → entre les jambes → derrière le dos, en changeant de main après chaque série.",
      cues: ["Centre de gravité bas", "Regard levé", "Changement de rythme"]
    },
    "step-back": {
      cat: "Tir après dribble",
      fr: "Tir en step‑back",
      en: "Step‑back jumper",
      how: "Attaque en dribble, stop puissant, pas de recul pour créer l’espace, élève‑toi droit.",
      cues: ["Pied d’appui stable", "Épaule/hanche vendent la menace", "Suivi du tir (wrist snap)"]
    },
    "pull-up": {
      cat: "Tir après dribble",
      fr: "Pull‑up",
      en: "Pull‑up jumper",
      how: "Sprint court, freinage contrôlé, élévation immédiate pour tirer en suspension.",
      cues: ["Stop fort (2 temps/1‑2)", "Épaules au‑dessus des hanches", "Atterrissage équilibré"]
    },
    "spin move": {
      cat: "Finition/Création",
      fr: "Spin move",
      en: "Spin move",
      how: "Protège le ballon, pivote rapidement (360°) autour du défenseur, sors du spin équilibré vers le tir/lay‑up.",
      cues: ["Main faible protège", "Buste gainé", "Repose les yeux sur l’anneau à la sortie"]
    },
    "euro step": {
      cat: "Finition",
      fr: "Euro step",
      en: "Euro step",
      how: "Deux pas latéraux alternés pour contourner le défenseur avant la finition.",
      cues: ["Premier pas long, second anglé", "Change la vitesse", "Fixe l’aide du regard"]
    },
    "floater": {
      cat: "Finition",
      fr: "Floater",
      en: "Floater",
      how: "Petit tir en cloche au‑dessus des intérieurs, sans aller au contact.",
      cues: ["Angle haut", "Poignet souple", "Élan contrôlé (1‑2 ou saut arrêté)"]
    },
    "reverse layup": {
      cat: "Finition",
      fr: "Lay‑up main inversée",
      en: "Reverse layup",
      how: "Utilise le côté opposé du panneau pour protéger le ballon avec le cercle.",
      cues: ["Utilise la planche", "Change d’angle sous l’arceau", "Main loin du défenseur"]
    },
    "lancers-francs": {
      cat: "Tir",
      fr: "Lancers‑francs",
      en: "Free throws",
      how: "Routine identique à chaque tir ; 1 à 3 dribbles, inspire, vise l’arrière du cercle.",
      cues: ["Pieds ancrés (largeur épaules)", "Coude sous le ballon", "Suivi poignet/bras"]
    },
    "tirs à mi-distance": {
      cat: "Tir",
      fr: "Tirs à mi‑distance",
      en: "Mid‑range shots",
      how: "Recevoir carré, fléchir, tirer avec un temps de suspension stable.",
      cues: ["Équilibre 10 orteils au sol", "Coudes alignés", "Tenir la pose 1s"]
    },

    // Vitesse & conditionnement
    "suicides": {
      cat: "Conditionnement",
      fr: "Suicides (navettes)",
      en: "Suicide runs",
      how: "Navettes terrain : ligne de lancer franc → retour, médiane → retour, opposé LF → retour, ligne de fond → retour.",
      cues: ["Virages propres (pied extérieur)", "Bras actifs", "Respiration rythmée"]
    },
    "sprints": {
      cat: "Vitesse",
      fr: "Sprints courts (15–30 m)",
      en: "Short sprints",
      how: "Accélérations max sur 15–30 m, retour en marchant (repos complet).",
      cues: ["Inclinaison légère au départ", "Genoux hauts", "Pousser fort sur 5–6 premiers appuis"]
    },

    // Récup/retour au calme
    "étirements bas du corps": {
      cat: "Retour au calme",
      fr: "Étirements bas du corps",
      en: "Lower‑body stretching",
      how: "Ischios, quadriceps, mollets, hanches : 20–40 s par côté, 1–2 séries, sans douleur.",
      cues: ["Respiration lente", "Ne pas rebondir", "Cherche la détente"]
    },
    "étirements complets": {
      cat: "Retour au calme",
      fr: "Étirements complets",
      en: "Full‑body stretching",
      how: "Chaîne antérieure/postérieure et épaules : tenir 20–40 s, 1–2 séries.",
      cues: ["Progressif", "Sans douleur", "Hydrate‑toi après"]
    },

    // Organisation/notes
    "entraînement club": {
      cat: "Organisation",
      fr: "Entraînement en club",
      en: "Team practice",
      how: "Transfère les acquis individuels au collectif : spacing, timing des coupes, lecture écran.",
      cues: ["Communique", "Qualité > quantité", "Demande un feedback coach"]
    },
    "analyse vidéo": {
      cat: "Apprentissage",
      fr: "Analyse vidéo",
      en: "Film study",
      how: "Observe 1–2 mouvements clés d’un joueur, note points d’appuis, rythme et finitions.",
      cues: ["Ralentis x0.5", "Arrêts image sur le pied d’appui", "Reproduis à faible intensité"]
    },
    "conditionnement": {
      cat: "Conditionnement",
      fr: "Conditionnement",
      en: "Conditioning",
      how: "Combine navettes type suicides et sprints courts, gestion du repos pour maintenir la qualité.",
      cues: ["Chrono clair", "Technique de course propre", "Ne termine pas en échec total"]
    }
  });
} catch(e) { console.warn('Extend EX_DICT patch failed', e); }
// --- End conditioning/skills patch ---

function normalizeName(txt){
      let t = txt.toLowerCase();
      t = t.split('·')[0]; // before dot bullet
      t = t.split('(')[0]; // remove parenthesis
      t = t.replace(/[0-9×x/′'″–\-]+/g,'').trim(); // remove sets/reps, dashes
      // cleanup language tokens left by reps/units
      t = t.replace(/\b(jambe|j|côté|scôté|main|m)\b/g,'').replace(/\s{2,}/g,' ').trim();
      // common aliases mapping
      const map = {
        "depth drops":"depth drop",
        "depth jump (re-saut)":"depth jump",
        "box jump":"box jumps",
        "sauts sur box":"box jumps",
        "sauts grenouille":"leap frog jumps",
        "touches cercle":"rim touches",
        "touches de cercle":"rim touches",
        "sauts au cercle":"rim jumps",
        "skippings puissants":"power skipping",
        "drop & freeze (réception)":"drop & freeze",
        "soulevé jt (kb)":"soulevé jt",
        "kb swing (balancé)":"kb swing",
        "kb goblet squat":"goblet squat",
        "med-ball throws":"med-ball throws"
      };
      return map[t] || t;
    }

    function showExerciseInfo(raw){
      const key = normalizeName(raw);
      const ex = EX_DICT[key];
      $('#exModal').classList.add('open');
      $('#exClose').onclick = closeEx; $('#exOverlay').onclick = closeEx;
      function closeEx(){ $('#exModal').classList.remove('open'); }
      if(!ex){
        $('#exCat').textContent = "Bientôt";
        $('#exTitle').textContent = raw;
        $('#exAlt').textContent = "";
        $('#exHow').textContent = "Description détaillée en préparation.";
        $('#exCues').innerHTML = "";
        $('#exNote').textContent = "Si tu veux, envoie-moi une courte vidéo et je t’ajoute des cues personnalisés.";
        return;
      }
      $('#exCat').textContent = ex.cat || "";
      $('#exTitle').textContent = ex.fr;
      $('#exAlt').textContent = ex.en ? "EN: " + ex.en : "";
      $('#exHow').textContent = ex.how || "";
      const cues = ex.cues || [];
      $('#exCues').innerHTML = cues.map(c=> `<li>${c}</li>`).join("");
      $('#exNote').textContent = "Astuce : filme 2–3 répétitions (profil et face) pour vérifier alignement genoux/chevilles et temps de contact au sol.";
    }

    // Hook info buttons inside the workout modal items
    const oldOpenModal = openModal;
    openModal = function(iso, isToday){
      oldOpenModal(iso, isToday);
      // wait a tick to attach buttons
      setTimeout(()=>{
        $$('#workList .item').forEach(li=>{
          if(li.querySelector('button.info')) return;
          const txtNode = li.querySelector('div');
          const label = txtNode ? txtNode.textContent : "";
          const b = document.createElement('button');
          b.type='button';
          b.className='btn ghost info';
          b.style.padding='6px 10px'; b.style.fontSize='12px';
          b.textContent='i';
          b.title='Détails de l’exercice';
          b.addEventListener('click', (e)=>{
            e.stopPropagation();
            showExerciseInfo(label);
          });
          li.appendChild(b);
        });
      }, 0);
    };

  </script>
<!-- Exercise Info Modal -->
<div class="modal" id="exModal">
<div class="overlay" id="exOverlay"></div>
<div class="sheet">
<header>
<div class="titleRow">
<div>
<div id="exCat" style="font-size:12px; color:var(--muted)"></div>
<div id="exTitle" style="font-size:18px; font-weight:900">Exercice</div>
<div id="exAlt" style="font-size:12px; color:var(--muted)"></div>
</div>
<button class="x" id="exClose">✕</button>
</div>
</header>
<div class="content" id="exContent" style="display:grid; gap:10px">
<div class="pill" id="exLangs">FR / EN</div>
<div class="card" style="padding:12px">
<div style="font-weight:800; margin-bottom:6px">Comment faire</div>
<div id="exHow"></div>
</div>
<div class="card" style="padding:12px">
<div style="font-weight:800; margin-bottom:6px">Cues (repères)</div>
<ul id="exCues" style="margin:0; padding-left:18px"></ul>
</div>
<div class="muted" id="exNote"></div>
</div>
</div>
</div>
</body>
</html>
